"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{moveTabSelected:function(e,o,t){var l,s,n,c,i=this,d=this.afterFullData,r=this.visibleColumn,a=this.editConfig,h=this.isSeqColumn,u=Object.assign({},e),m=d.indexOf(u.row),f=r.indexOf(u.column);if(t.preventDefault(),o){for(var g=f-1;0<=g;g--)if(!h(r[g])){n=r[c=g];break}if(!n&&0<m){l=d[s=m-1];for(var x=r.length-1;0<=x;x--)if(!h(r[x])){n=r[c=x];break}}}else{for(var p=f+1;p<r.length;p++)if(!h(r[p])){n=r[c=p];break}if(!n&&m<d.length-1){l=d[s=m+1];for(var C=0;C<r.length;C++)if(!h(r[C])){n=r[c=C];break}}}n&&(l?(u.rowIndex=s,u.row=l):u.rowIndex=m,u.columnIndex=c,u.column=n,u.cell=_tools.DomTools.getCell(this,u),a&&("click"!==a.trigger&&"dblclick"!==a.trigger||("row"===a.mode?this.handleActived(u,t):this.scrollToRow(u.row,u.column).then(function(){return i.handleSelected(u,t)}))))},moveCurrentRow:function(e,o,t){var l,s=this,n=this.currentRow,c=this.treeConfig,i=this.treeOpts,d=this.afterFullData;if(t.preventDefault(),c){var r=_xeUtils.default.findTree(d,function(e){return e===n},i),a=r.index,h=r.items;e&&0<a?l=h[a-1]:o&&a<h.length-1&&(l=h[a+1])}else{var u=d.indexOf(n);e&&0<u?l=d[u-1]:o&&u<d.length-1&&(l=d[u+1])}if(l){var m={$table:this,row:l};this.scrollToRow(l).then(function(){return s.triggerCurrentRowEvent(t,m)})}},moveSelected:function(e,o,t,l,s,n){var c=this,i=this.afterFullData,d=this.visibleColumn,r=this.isSeqColumn,a=Object.assign({},e);if(n.preventDefault(),t&&a.rowIndex)--a.rowIndex,a.row=i[a.rowIndex];else if(s&&a.rowIndex<i.length-1)a.rowIndex+=1,a.row=i[a.rowIndex];else if(o&&a.columnIndex){for(var h=a.columnIndex-1;0<=h;h--)if(!r(d[h])){a.columnIndex=h,a.column=d[h];break}}else if(l)for(var u=a.columnIndex+1;u<d.length;u++)if(!r(d[u])){a.columnIndex=u,a.column=d[u];break}this.scrollToRow(a.row,a.column).then(function(){a.cell=_tools.DomTools.getCell(c,a),c.handleSelected(a,n)})},triggerHeaderCellMousedownEvent:function(e,o){var d=this.$el,t=this.tableData,l=this.mouseConfig,s=void 0===l?{}:l,n=this.elemStore,r=this.handleChecked,a=this.handleHeaderChecked,c=e.button,i=o.column,h=o.cell,u=0===c,m="seq"===i.type||"index"===i.type;if(u){if(s.checked){var f=n["main-header-list"].children,g=n["main-body-list"].children;if(m)this.handleAllChecked(e);else{this.clearSelected(e),this.clearHeaderChecked(),this.clearIndexChecked();var x=document.onmousemove,p=document.onmouseup,C=g[0].querySelector(".".concat(i.id)),v=_xeUtils.default.throttle(function(e){var o=_tools.DomTools.getEventTargetNode(e,d,"vxe-header--column"),t=o.flag,l=o.targetElem;if(!t){var s=_tools.DomTools.getEventTargetNode(e,d,"vxe-body--column");t=s.flag,l=s.targetElem}if(t&&!_tools.DomTools.hasClass(l,"col--seq")){var n=[].indexOf.call(l.parentNode.children,l),c=g[g.length-1].children[n],i=f[0].children[n];a(_tools.DomTools.getRowNodes(f,_tools.DomTools.getCellNodeIndex(i),_tools.DomTools.getCellNodeIndex(h))),r(_tools.DomTools.getRowNodes(g,_tools.DomTools.getCellNodeIndex(C),_tools.DomTools.getCellNodeIndex(c)))}},80,{leading:!0,trailing:!0});if(_tools.DomTools.addClass(d,"c--checked"),document.onmousemove=function(e){e.preventDefault(),e.stopPropagation(),v(e)},document.onmouseup=function(){_tools.DomTools.removeClass(d,"c--checked"),document.onmousemove=x,document.onmouseup=p},a([[h]]),g.length){var _=g[g.length-1].querySelector(".".concat(i.id)),y=g[0],T=g[g.length-1],D=y.querySelector(".col--seq");o.rowIndex=0,o.row=t[0],o.cell=_tools.DomTools.getCell(this,o),this.handleSelected(o,e),this.handleIndexChecked(_tools.DomTools.getRowNodes(g,_tools.DomTools.getCellNodeIndex(D),_tools.DomTools.getCellNodeIndex(T.querySelector(".col--seq")))),this.handleChecked(_tools.DomTools.getRowNodes(g,_tools.DomTools.getCellNodeIndex(C),_tools.DomTools.getCellNodeIndex(_)))}}}this.closeMenu()}this.isActivated=!0},triggerCellMousedownEvent:function(e,o){var d=this.$el,t=this.visibleColumn,l=this.editStore,s=this.editConfig,n=this.handleSelected,c=this.checkboxOpts,i=this.mouseConfig,r=void 0===i?{}:i,a=this.handleChecked,h=this.handleIndexChecked,u=this.handleHeaderChecked,m=this.elemStore,f=l.checked,g=o.column,x=o.cell;if(0===e.button){if(r.checked){this.clearHeaderChecked(),this.clearIndexChecked();var p=document.onmousemove,C=document.onmouseup,v=_tools.DomTools.getCellNodeIndex(x),_="seq"===g.type||"index"===g.type,y=m["main-body-list"].children,T=m["main-header-list"].children,D=x.parentNode.lastElementChild,k=x.parentNode.firstElementChild,N=[].indexOf.call(x.parentNode.children,x),w=T[0].children[N],b=_xeUtils.default.throttle(function(e){var o=_tools.DomTools.getEventTargetNode(e,d,"vxe-body--column"),t=o.flag,l=o.targetElem;if(t)if(_){var s=l.parentNode.firstElementChild;a(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(s.nextElementSibling),_tools.DomTools.getCellNodeIndex(D))),h(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(s),_tools.DomTools.getCellNodeIndex(x)))}else if(!_tools.DomTools.hasClass(l,"col--seq")){var n=l.parentNode.firstElementChild,c=[].indexOf.call(l.parentNode.children,l),i=T[0].children[c];u(_tools.DomTools.getRowNodes(T,_tools.DomTools.getCellNodeIndex(i),_tools.DomTools.getCellNodeIndex(w))),h(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(n),_tools.DomTools.getCellNodeIndex(k))),a(_tools.DomTools.getRowNodes(y,v,_tools.DomTools.getCellNodeIndex(l)))}},80,{leading:!0,trailing:!0});if(document.onmousemove=function(e){e.preventDefault(),e.stopPropagation(),b(e)},document.onmouseup=function(e){document.onmousemove=p,document.onmouseup=C},_){var I=x.parentNode.firstElementChild;o.columnIndex++,o.column=t[o.columnIndex],o.cell=x.nextElementSibling,n(o,e),a(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(I.nextElementSibling),_tools.DomTools.getCellNodeIndex(D))),u([T[0].querySelectorAll(".vxe-header--column:not(.col--seq)")]),h(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(I),_tools.DomTools.getCellNodeIndex(x)))}else{var S=x.parentNode.firstElementChild;n(o,e),u([[T[0].querySelector(".".concat(g.id))]]),h([[S]])}}else c.range&&this.handleCheckboxRangeEvent(e,o);this.closeFilter(),this.closeMenu()}else r.selected&&s&&"dblclick"===s.trigger&&(f.rowNodes&&f.rowNodes.some(function(e){return-1<e.indexOf(x)})||n(o,e));this.isActivated=!0},getRangeResult:function(e,o){for(var t=0,l=[],s=0<o?"next":"previous",n=0<o?o:Math.abs(o)+e.offsetHeight;e&&t<n;)l.push(this.getRowNode(e).item),t+=e.offsetHeight,e=e["".concat(s,"ElementSibling")];return l},handleCheckboxRangeEvent:function(e,o){var n=this,t=o.column,l=o.cell;if(-1<["checkbox","selection"].indexOf(t.type)){var c=e.clientX,i=e.clientY,d=this.$refs.checkboxRange,s=document.onmousemove,r=document.onmouseup,a=l.parentNode,h=_tools.DomTools.getAbsolutePos(a),u=this.getCheckboxRecords(),m=[];this.updateZindex(),document.onmousemove=function(e){e.preventDefault(),e.stopPropagation();var o=e.clientX-c,t=e.clientY-i,l=Math.abs(t),s=n.getRangeResult(a,e.clientY-h.top);d.style.display="block",d.style.width="".concat(Math.abs(o),"px"),d.style.height="".concat(l,"px"),d.style.left="".concat(c+(0<o?0:o),"px"),d.style.top="".concat(i+(0<t?0:t),"px"),d.style.zIndex="".concat(n.tZindex),10<l&s.length!==m.length&&(m=s,e.ctrlKey?s.forEach(function(e){n.handleSelectRow({row:e},-1===u.indexOf(e))}):(n.clearCheckboxRow(),n.setCheckboxRow(s,!0)))},document.onmouseup=function(e){d.removeAttribute("style"),document.onmousemove=s,document.onmouseup=r}}},_clearChecked:function(){var e=this.$refs,o=this.editStore,t=this.mouseConfig,l=o.checked;if(t&&t.checked){var s=e.tableBody;l.rows=[],l.columns=[],l.tRows=[],l.tColumns=[],s.$refs.checkBorders.style.display="none",_xeUtils.default.arrayEach(s.$el.querySelectorAll(".col--checked"),function(e){return _tools.DomTools.removeClass(e,"col--checked")})}return this.$nextTick()},_getMouseSelecteds:function(){var e=this.editStore.selected,o=e.args,t=e.column;return o&&t?Object.assign({},o):null},_getMouseCheckeds:function(){var o=this,e=this.editStore.checked.rowNodes,t=void 0===e?[]:e,l=[],s=[];return t&&t.length&&(s=t.map(function(e){return o.getRowNode(e[0].parentNode).item}),l=t[0].map(function(e){return o.getColumnNode(e).item})),{columns:l,rows:s,rowNodes:t}},handleChecked:function(e){var o=this.editStore.checked;this.clearChecked();var s=-2,n=-2,c=0,i=0;_xeUtils.default.arrayEach(e,function(e,o){var l=0===o;_xeUtils.default.arrayEach(e,function(e,o){var t=0===o;t&&l&&(c=e.offsetTop,i=e.offsetLeft),l&&(s+=e.offsetWidth),t&&(n+=e.offsetHeight),_tools.DomTools.addClass(e,"col--checked")})});var t=this.$refs.tableBody.$refs,l=t.checkBorders,d=t.checkTop,r=t.checkRight,a=t.checkBottom,h=t.checkLeft;l.style.display="block",Object.assign(d.style,{top:"".concat(c,"px"),left:"".concat(i,"px"),width:"".concat(s,"px")}),Object.assign(r.style,{top:"".concat(c,"px"),left:"".concat(i+s,"px"),height:"".concat(n,"px")}),Object.assign(a.style,{top:"".concat(c+n,"px"),left:"".concat(i,"px"),width:"".concat(s,"px")}),Object.assign(h.style,{top:"".concat(c,"px"),left:"".concat(i,"px"),height:"".concat(n,"px")}),o.rowNodes=e},handleAllChecked:function(e){var o=this.tableData,t=this.visibleColumn,l=this.mouseConfig,s=void 0===l?{}:l,n=this.elemStore;if(s.checked){e.preventDefault();var c=n["main-header-list"],i=c.children,d=n["main-body-list"].children,r=_xeUtils.default.find(t,function(e){return"seq"===e.type||"index"===e.type})||t[0],a=c.querySelector(".".concat(r.id)),h=d[0],u=d[d.length-1],m=h.querySelector(".".concat(r.id)),f={$table:this,rowIndex:0,row:o[0],column:_xeUtils.default.find(t,function(e){return e.property})};f.columnIndex=this.getColumnIndex(f.column),f.cell=_tools.DomTools.getCell(this,f),this.handleSelected(f,e),this.handleHeaderChecked(_tools.DomTools.getRowNodes(i,_tools.DomTools.getCellNodeIndex(a.nextElementSibling),_tools.DomTools.getCellNodeIndex(a.parentNode.lastElementChild))),this.handleIndexChecked(_tools.DomTools.getRowNodes(d,_tools.DomTools.getCellNodeIndex(m),_tools.DomTools.getCellNodeIndex(u.querySelector(".".concat(r.id))))),this.handleChecked(_tools.DomTools.getRowNodes(d,_tools.DomTools.getCellNodeIndex(m.nextElementSibling),_tools.DomTools.getCellNodeIndex(u.lastElementChild)))}},handleIndexChecked:function(e){var o=this.editStore.indexs;this.clearIndexChecked(),_xeUtils.default.arrayEach(e,function(e){_xeUtils.default.arrayEach(e,function(e){_tools.DomTools.addClass(e,"col--seq-checked")})}),o.rowNodes=e},_clearIndexChecked:function(){var e=this.elemStore["main-body-list"];return _xeUtils.default.arrayEach(e.querySelectorAll(".col--seq-checked"),function(e){return _tools.DomTools.removeClass(e,"col--seq-checked")}),this.$nextTick()},handleHeaderChecked:function(e){var o=this.editStore.titles;this.clearHeaderChecked(),_xeUtils.default.arrayEach(e,function(e){_xeUtils.default.arrayEach(e,function(e){_tools.DomTools.addClass(e,"col--title-checked")})}),o.rowNodes=e},_clearHeaderChecked:function(){var e=this.elemStore["main-header-list"];return e&&_xeUtils.default.arrayEach(e.querySelectorAll(".col--title-checked"),function(e){return _tools.DomTools.removeClass(e,"col--title-checked")}),this.$nextTick()},_clearCopyed:function(){var e=this.$refs,o=this.editStore,t=this.keyboardConfig,l=o.copyed;if(t&&t.isCut){var s=e.tableBody,n=e.tableBody.$refs.copyBorders;l.cut=!1,l.rows=[],l.columns=[],n.style.display="none",_xeUtils.default.arrayEach(s.$el.querySelectorAll(".col--copyed"),function(e){return _tools.DomTools.removeClass(e,"col--copyed")})}return this.$nextTick()},handleCopyed:function(e){var o=this.tableData,t=this.tableColumn,l=this.editStore,s=l.copyed,n=l.checked.rowNodes;this.clearCopyed();var c=-3,i=-3,d=0,r=0,a=[],h=[];if(n.length){var u=n[0],m=_tools.DomTools.getCellNodeIndex(u[0]),f=m.rowIndex,g=m.columnIndex;a=t.slice(g,g+u.length),h=o.slice(f,f+n.length)}_xeUtils.default.arrayEach(n,function(e,o){var l=0===o;_xeUtils.default.arrayEach(e,function(e,o){var t=0===o;t&&l&&(d=e.offsetTop,r=e.offsetLeft),l&&(c+=e.offsetWidth),t&&(i+=e.offsetHeight),_tools.DomTools.addClass(e,"col--copyed")})});var x=this.$refs.tableBody.$refs,p=x.copyBorders,C=x.copyTop,v=x.copyRight,_=x.copyBottom,y=x.copyLeft;p.style.display="block",Object.assign(C.style,{top:"".concat(d,"px"),left:"".concat(r,"px"),width:"".concat(c,"px")}),Object.assign(v.style,{top:"".concat(d,"px"),left:"".concat(r+c,"px"),height:"".concat(i,"px")}),Object.assign(_.style,{top:"".concat(d+i,"px"),left:"".concat(r,"px"),width:"".concat(c,"px")}),Object.assign(y.style,{top:"".concat(d,"px"),left:"".concat(r,"px"),height:"".concat(i,"px")}),s.cut=e,s.rows=h,s.columns=a,s.rowNodes=n},handlePaste:function(){var o=this.tableData,n=this.visibleColumn,e=this.editStore,t=this.elemStore,l=e.copyed,s=e.selected,c=l.cut,i=l.rows,d=l.columns;if(i.length&&d.length&&s.row&&s.column){var r=s.args,a=r.rowIndex,h=r.columnIndex;_xeUtils.default.arrayEach(i,function(l,e){var s=o[a+e];s&&_xeUtils.default.arrayEach(d,function(e,o){var t=n[h+o];t&&_tools.UtilTools.setCellValue(s,t,_tools.UtilTools.getCellValue(l,e)),c&&_tools.UtilTools.setCellValue(l,e,null)})}),c&&this.clearCopyed();var u=t["main-body-list"].children,m=s.args.cell,f=m.parentNode,g=_xeUtils.default.arrayIndexOf(f.children,m),x=u[_xeUtils.default.arrayIndexOf(u,f)+i.length-1].children[g+d.length-1];this.handleChecked(_tools.DomTools.getRowNodes(u,_tools.DomTools.getCellNodeIndex(m),_tools.DomTools.getCellNodeIndex(x)))}}}};exports.default=_default;